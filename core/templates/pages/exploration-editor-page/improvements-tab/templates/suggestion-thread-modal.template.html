<div class="modal-header oppia-modal-header">
  <h3 class="oppia-get-title"><[getTitle()]></h3>

  <div class="text-left oppia-text-left">
    <span ng-class="getLabelClass(activeThread.status)">
      <[getHumanReadableStatus(activeThread.status)]>
    </span>
  </div>

  <div class="oppia-clear"></div>
</div>

<div class="modal-body">
  <ol ng-if="activeThread.messages.length > 0" class="thread-messages oppia-thread-messages">
    <li ng-repeat="m in activeThread.messages | orderBy:'m.messageId'"
        class="protractor-test-improvements-thread-message">
      <div class="oppia-get-title">
        <span ng-if="$index !== 0">#<[m.messageId]></span>
        <span class="protractor-test-improvements-thread-message-author">
          <span ng-if="m.authorUsername">by <strong><[m.authorUsername]></strong></span>
          <em ng-if="!m.authorUsername">(anonymously submitted)</em>
        </span>
      </div>

      <div class="text-right oppia-text-right">
        <[getLocaleAbbreviatedDatetimeString(m.createdOnMsecs)]>
      </div>

      <div ng-if="m.messageId !== 0"
           class="oppia-message-id protractor-test-improvements-thread-message-status-change">
        <span ng-if="m.updatedStatus">
          <em>Status changed to '<[getHumanReadableStatus(m.updatedStatus)]>'</em>
        </span>
        <span ng-if="m.updatedSubject">
          <em>Subject changed to '<[m.updatedSubject]>'</em>
        </span>
      </div>

      <div class="oppia-clear"></div>

      <p ng-if="m.messageId !== 0" class="protractor-test-improvements-thread-message-body">
        <[m.text]>
      </p>
      <p ng-if="m.messageId === 0" class="protractor-test-improvements-thread-message-body">
        <[activeThread.subject]>
      </p>
      <button ng-click="onClickReviewSuggestion()" ng-if="m.messageId === 0"
              class="btn btn-primary protractor-test-improvements-review-suggestion-button">
        Review Suggestion
      </button>
    </li>
  </ol>
</div>

<div class="modal-footer oppia-modal-header">
  <div ng-if="isUserLoggedIn" class="text-left">
    <label for="tmpMessageText">Add new message</label>
    <textarea ng-model="tmpMessage.text" ng-disabled="messageSendingInProgress"
              class="form-control protractor-test-improvements-response-textarea oppia-improvements-response-textarea"
              id="tmpMessageText" rows="6">
    </textarea>

    <div class="text-right oppia-text-right-extra">
      <button ng-click="addNewMessage(tmpMessage.text, tmpMessage.status)"
              ng-disabled="messageSendingInProgress || (!tmpMessage.text && activeThread.status === tmpMessage.status) || (!tmpMessage.text && (tmpMessage.status === 'ignored' || tmpMessage.status === 'not_actionable'))"
              class="btn btn-success protractor-test-improvements-response-send-button oppia-improvements-response-send-button">
        <span ng-if="messageSendingInProgress">Sending...</span>
        <span ng-if="!messageSendingInProgress">Send and Close</span>
      </button>
      <button ng-click="close()" ng-disabled="messageSendingInProgress"
              class="btn btn-secondary protractor-test-improvements-close-modal-button oppia-improvements-close-modal-button">
        Close
      </button>
    </div>
    <div class="oppia-clear"></div>
  </div>

  <div ng-if="!isUserLoggedIn">
    <em class="oppia-suggestion-thread">To respond to a suggestion thread, please log in.</em>
    <div class="oppia-text-right-extra">
      <button ng-click="close()" ng-disabled="messageSendingInProgress"
              class="btn btn-secondary protractor-test-improvements-close-modal-button oppia-improvements-close-modal-button">
        Close
      </button>
    </div>
    <div class="oppia-clear"></div>
  </div>
</div>


<style>
  ol.thread-messages {
    list-style: none;
    margin: 0;
  }
  ol.thread-messages li {
    padding-top: 0.5em;
    padding-bottom: 1em;
    border-bottom: 1px solid #eee;
  }
  ol.thread-messages li:last-child {
    border-bottom: 0;
    padding-bottom: 0;
  }
  ol.thread-messages li:first-child {
    padding-top: 0;
  }
  .oppia-modal-header {
    display: block;
  }
  .oppia-get-title {
    float: left;
  }
  .oppia-text-left {
    float: right;
  }
  .oppia-clear {
    clear: both;
  }
  .oppia-thread-messages {
    padding: 0 10px;
  }
  .oppia-text-right {
    float: right;
    margin-left: 2ch;
  }
  .oppia-text-right-extra {
    float: right;
  }
  .oppia-message-id {
    float: right;
    width: 28ch;
  }
  .oppia-improvements-response-textarea {
    margin-bottom: 10px;
  }
  .oppia-improvements-response-send-button {
    margin-left: 8px;
  }
  .oppia-improvements-close-modal-button {
    margin-right: 0;
  }
  .oppia-suggestion-thread {
    float: left;
    padding: 6px 0;
  }
</style>
